<!-- page content -->
<div class="right_col" role="main">
  <div class="">
    <div class="page-title">
      <div class="title_left">
        <h3><%= brand.brandName %> <small> Details</small></h3>
      </div>
    </div>

    <div class="clearfix"></div>

    <div class="row">
      <div class="col-md-12">
        <div class="" role="tabpanel" data-example-id="togglable-tabs">
          <ul id="myTab" class="nav nav-tabs bar_tabs" role="tablist">
            <li role="presentation" class="active"><a href="#tab_content1" id="home-tab" role="tab" data-toggle="tab" aria-expanded="true">Products</a>
            </li>
            <li role="presentation" class=""><a href="#tab_content2" role="tab" id="profile-tab" data-toggle="tab" aria-expanded="false">Users</a>
            </li>
          </ul>
          <div id="myTabContent" class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="tab_content1" aria-labelledby="home-tab">
              <div class="row">
                <div class="col-md-12">
                  <div class="x_panel">
                    <div class="x_content">
                      <!-- start project list --><div class="pull-right"><input type="text" placeholder="search" class="searchBar"><button class="searchButton">Search Table</button></div>
                      <table id="knownProducts" class="table table-striped projects" cellspacing="0" width="100%" >
                        <thead>
                          <tr>
                            <th>_id</th>
                            <th>barcode</th>
                            <th>title</th>
                            <th>brand</th>
                            <th>name</th>
                            <th>ean</th>
                            <th>category1</th>
                          </tr>
                        </thead>
                      </table>
                      <div class="pull-right">
                        <button class="previousPage">Previous Page</button>
                        <button class="nextPage">Next Page</button>
                        <h5 id="pages"></h5>
                      </div>
                      <!-- end project list -->
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="tab_content2" aria-labelledby="profile-tab">
              <div class="row">
                <div class="col-md-12">
                  <div class="x_panel">
                    <div class="x_content">

                      <!-- start project list -->
                      <table class="table table-hover projects">
                        <thead>
                          <tr>
                            <th>Username</th>
                            <th>Full name</th>
                            <th>Email</th>
                            <th>Phone</th>
                          </tr>
                        </thead>
                        <tbody>
                          <% for(var i=0; i<users.length; i++){ %>
                            <tr>
                              <td>
                                <%= users[i].username %>
                              </td>
                              <td>
                                <%= users[i].full_name %>
                              </td>
                              <td>
                                <%= users[i].email %>
                              </td>
                              <td>
                                <%= users[i].phone %>
                              </td>
                            </tr>
                            <% } %>
                        </tbody>
                      </table>
                      <!-- end project list -->
                      <div class="pull-right">
                          <button class="previousPage2">Previous Page</button>
                          <button class="nextPage2">Next Page</button>
                          <h5 id="pages2"></h5>
                      </div>

                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="myModal" class="modal fade" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-hidden="true" style="padding-top:15%; overflow-y:visible;">
    		<div class="modal-dialog modal-sm">
    		<div class="modal-content">
    			<div class="modal-header">
    			    <h3 style="margin:0;">
    			        Messages
    			    </h3>
    			</div>
    			<div class="modal-body">
    				<div class="progress progress-striped active" style="margin-bottom:0;">
    				    <div class="progress-bar progress-bar-success" style="width: 100%">
    				    </div>
    				</div>
                </div>
            </div>
        </div>
    </div>
    <script>
    $(document).ready(function(){
      var pagesCounter=1;
      jQuery.support.cors = true;
      $.ajax(
      {
        type: "GET",
        url:  '/api/getAll',
        data: 'type=' + '<%= brand.brandName %>',
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        beforeSend:function(){
          $('#myModal').modal("show");
           $('.modal-header h3').html('Processing...')
        },
        success: function (data) {
          pagesCounter++;
          var trHTML = '';
          console.log(data.page);
          $("#pages").html("Page # "+data.page+" out of "+data.pages+" Pages");
          $.each(data.docs, function (i, item) {
            trHTML += '<tr><td>' + item._id + '</td><td>' + item.barcode + '</td><td>' + item.title + '</td><td>' + item.brand + '</td></tr>';
          });
          $('#knownProducts').append(trHTML);
          $('#myModal').modal("hide");
        },
        error: function (msg) {
          alert(msg.responseText);
        }
      });
      //next page logic
      $(".nextPage").on("click",function(){
        $.ajax(
          {
            type: "GET",
            url:  '/api/getAll',
            data:'page='+pagesCounter+'&'+'type=' + '<%= brand.brandName %>',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            beforeSend:function(){
              $('#myModal').modal("show");
              $('.modal-header h3').html('Processing...');
            },
            success: function (data) {
              pagesCounter++;
              var trHTML = '';
              console.log(data.page);
              $("#pages").html("Page # "+data.page+" out of "+data.pages+" Pages");
              $("#knownProducts").find("tr:gt(0)").remove();
              $.each(data.docs, function (i, item) {
                if(item.title){
                  trHTML += '<tr><td>' + item.id + '</td><td>' + item.barcode + '</td><td>' + item.title + '</td><td>' + item.brand + '</td></tr>';
                }else{
                  trHTML += '<tr><td></td><td></td><td></td><td>' + item.brand + '</td><td>' + item.name + '</td><td>' + item.ean + '</td><td>' + item.category1 + '</td></tr>';
                }
              });
              $('#knownProducts').append(trHTML);
              $('#myModal').modal("hide");
            },
            error: function (msg) {
              alert(msg.responseText);
            }
          });
        })
        //prev pages
        $(".previousPage").on("click",function(){
          pagesCounter=pagesCounter-2;
          $.ajax(
          {
            type: "GET",
            url:  '/api/getAll',
            data:'page='+pagesCounter+'&'+'type=' + '<%= brand.brandName %>',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            beforeSend:function(){
              $('#myModal').modal("show");
              $('.modal-header h3').html('Processing...')
            },
            success: function (data) {
              pagesCounter++;
              var trHTML = '';
              console.log(data.page);
              $("#pages").html("Page # "+data.page+" out of "+data.pages+" Pages");
              $("#knownProducts").find("tr:gt(0)").remove();
              $.each(data.docs, function (i, item) {
                if(item.title){
                  trHTML += '<tr><td>' + item.id + '</td><td>' + item.barcode + '</td><td>' + item.title + '</td><td>' + item.brand + '</td></tr>';
                }else{
                  trHTML += '<tr><td></td><td></td><td></td><td>' + item.brand + '</td><td>' + item.name + '</td><td>' + item.ean + '</td><td>' + item.category1 + '</td></tr>';
                }
              });
              $('#knownProducts').append(trHTML);
              $('#myModal').modal("hide");
            },
            error: function (msg) {
              alert(msg.responseText);
            }
          });
        })
        //Search Table
        $(".searchButton").on("click",function(){
          var query=$(".searchBar").val();
          $.ajax(
          {
            type: "GET",
            url:  '/api/dbSearch',
            data:'q='+query+'&'+'type=' + '<%= brand.brandName %>',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            beforeSend:function(){
              $('#myModal').modal("show");
              $('.modal-header h3').html('Processing...')
            },
            success: function (data) {
              pagesCounter++;
              var trHTML = '';
              console.log(data.page);
              $("#pages").html("search results");
              $("#knownProducts").find("tr:gt(0)").remove();
              $.each(data, function (i, item) {
                if(item.title){
                  trHTML += '<tr><td>' + item.id + '</td><td>' + item.barcode + '</td><td>' + item.title + '</td><td>' + item.brand + '</td></tr>';
                }else{
                  trHTML += '<tr><td></td><td></td><td></td><td>' + item.brand + '</td><td>' + item.name + '</td><td>' + item.ean + '</td><td>' + item.category1 + '</td></tr>';
                }
              });
              $('#knownProducts').append(trHTML);
              $('#myModal').modal("hide");
            },
            error: function (msg) {
              alert(msg.responseText);
            }
          });
        });
      });
    </script>
  </div>
</div>
<!-- /page content -->
